@{
    ViewData["Title"] = "Trang chủ";
    Layout = "_layout";
}

<div class="card mb-4 shadow-sm">
    <div class="card-body text-center">
        <!-- Tiêu đề -->
        <h4 class="mb-2">Giám sát nhiệt độ và độ rung động cơ</h4>
        <p class="text-muted">Theo Dõi Nhiệt Độ Và Độ Rung Trong Thời Gian Thực</p>

        <!-- Nút Bắt đầu / Dừng -->
        <div class="d-flex justify-content-center gap-3 mb-3">
            <a class="btn btn-success">Bắt Đầu</a>
            <a class="btn btn-outline-secondary">Dừng</a>
        </div>

        <!-- Nút chọn động cơ -->
        <div class="d-flex justify-content-center gap-3 flex-wrap">
            
            <button id="btnRobot" class="btn btn-outline-secondary" onclick="selectEngine('panelRobot', 'btnRobot')">Động Cơ Robot</button>
            <button id="btnPump" class="btn btn-outline-secondary" onclick="selectEngine('panelPump', 'btnPump')">Động Cơ Bơm</button>
            <button id="btnFan" class="btn btn-outline-secondary" onclick="selectEngine('panelFan', 'btnFan')">Động Cơ Quạt</button>
        </div>
        
    </div>
</div>
<div class="card shadow-sm p-4 mb-4">
    <div id="panelRobot" class="engine-panel" style="display: none;">
        <div class="row">
            <!-- Nhiệt độ -->
            <div class="col-md-6 mb-3">
                <div class="p-3 bg-success bg-opacity-25 rounded text-start">
                    <h5><i class="fas fa-thermometer-half"></i> Nhiệt Độ</h5>
                    <h1><span id="temperatureValue">-- °C</span></h1>
                    <span class="text-success fw-bold"><i class="fas fa-check-circle"></i> Bình thường</span>
                </div>
            </div>

            <!-- Độ rung -->
            <div class="col-md-6 mb-3">
                <div class="p-3 bg-danger bg-opacity-25 rounded text-start">
                    <h5><i class="fas fa-microchip"></i> Độ Rung</h5>
                    <h1><span id="vibrationValue">-- G</span></h1>
                    <span class="text-danger fw-bold"><i class="fas fa-exclamation-circle"></i> Nguy hiểm!</span>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Biểu đồ nhiệt độ -->
            <div class="col-md-6 mb-4">
                <h6><i class="fas fa-chart-line text-primary"></i> Biểu Đồ Nhiệt Độ</h6>
                <canvas id="temperatureChart" height="200"></canvas>
            </div>

            <!-- Biểu đồ độ rung -->
            <div class="col-md-6 mb-4">
                <h6><i class="fas fa-wave-square text-danger"></i> Biểu Đồ Độ Rung</h6>
                <canvas id="vibrationChart" height="200"></canvas>
            </div>
        </div>

        <!-- Tình trạng tổng thể -->
        <div class="mt-3 p-3 rounded bg-warning bg-opacity-25">
            <h6 class="text-success"><i class="fas fa-heartbeat"></i> Tình trạng tổng thể</h6>
            <span class="text-danger fw-bold">Cần Kiểm Tra Gấp!!!</span>
        </div>
    </div>  
    <div id="panelPump" class="engine-panel" style="display: none;">
        <div class="p-4 bg-light rounded border">
            <h4>Chào mừng đến với động cơ bơm</h4>
            <p>Nhiệt độ: 27°C – Bình thường</p>
            <p>Độ rung: 5.1G – An toàn</p>
            <p>Tình trạng tổng thể: Bình thường</p>
        </div>
    </div>
</div>
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
       
        const temperatureCtx = document.getElementById('temperatureChart').getContext('2d');
        const vibrationCtx = document.getElementById('vibrationChart').getContext('2d');

        function showPanel(panelId) {
            // Ẩn tất cả các panel trước
            document.querySelectorAll('.engine-panel').forEach(el => el.style.display = 'none');

            // Hiện panel được chọn
            const target = document.getElementById(panelId);
            if (target) target.style.display = 'block';
            // Khi trang load lần đầu, hiển thị panelRobot
            
        }
        function selectEngine(panelId, buttonId) {
            // Hiển thị panel tương ứng
            showPanel(panelId);

            // Reset các nút về trạng thái mặc định
            ['btnRobot', 'btnPump', 'btnFan'].forEach(id => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-secondary');
                    // btn.disabled = false;
                    btn.style.pointerEvents = 'auto'; // bật lại click
                    btn.style.opacity = '1';
                }
            });

            // Highlight nút được chọn và disable
            const selectedBtn = document.getElementById(buttonId);
            if (selectedBtn) {
                selectedBtn.classList.remove('btn-outline-secondary');
                selectedBtn.classList.add('btn-success');
                // selectedBtn.disabled = true;
                selectedBtn.style.pointerEvents = 'none'; // không cho bấm nhưng vẫn đậm
                selectedBtn.style.opacity = '1'; // giữ màu rõ
            }
        }
        // Khi trang được load xong, hiển thị panelRobot
        // document.addEventListener('DOMContentLoaded', function () {
        //     showPanel('panelRobot');
        // });
            window.onload = function () {
            selectEngine('panelRobot', 'btnRobot');

        };

        function updateSensorDisplay() {
            fetch('/Home/GenerateSensorData')
                .then(res => res.json())
                .then(data => {
                    document.getElementById("temperatureValue").textContent = data.temperature + " °C";
                    document.getElementById("vibrationValue").textContent = data.vibration + " G";
                    

                });
        }
        // Gọi lần đầu và sau đó mỗi 5 giây
        setInterval(updateSensorDisplay, 1000); // Gọi mỗi 5 giây
        document.addEventListener('DOMContentLoaded', updateSensorDisplay); // Gọi khi vừa load

        const temperatureChart = new Chart(temperatureCtx, {
            type: 'line',
            data: {
                labels: ['08:35:09', '08:35:19', '08:35:24', '08:35:30', '08:35:34', '08:35:38'],
                datasets: [{
                    label: 'Nhiệt độ (°C)',
                    data: [100, 75, 60, 70, 95, 50],
                    borderColor: 'blue',
                    backgroundColor: 'rgba(0, 0, 255, 0.2)',
                    fill: true,
                    tension: 0.3,
                    pointStyle: 'circle',
                    pointRadius: 5,
                }]
            }
        });

        const vibrationChart = new Chart(vibrationCtx, {
            type: 'line',
            data: {
                labels: ['08:35:09', '08:35:19', '08:35:24', '08:35:30', '08:35:34', '08:35:38'],
                datasets: [{
                    label: 'Độ rung (G)',
                    data: [2, 3, 1.5, 6, 7, 6.92],
                    borderColor: 'purple',
                    backgroundColor: 'rgba(128, 0, 128, 0.2)',
                    fill: true,
                    tension: 0.3,
                    pointStyle: 'rect',
                    pointRadius: 5,
                }]
            }
        });
    </script>
}
